function ReadableState(a,b){var c=require("./_stream_duplex");a=a||{};var d=a.highWaterMark,e=a.objectMode?16:16384;this.highWaterMark=d||0===d?d:e,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!a.objectMode,b instanceof c&&(this.objectMode=this.objectMode||!!a.readableObjectMode),this.defaultEncoding=a.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,a.encoding&&(StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this.decoder=new StringDecoder(a.encoding),this.encoding=a.encoding)}function Readable(a){require("./_stream_duplex");return this instanceof Readable?(this._readableState=new ReadableState(a,this),this.readable=!0,void Stream.call(this)):new Readable(a)}function readableAddChunk(a,b,c,d,e){var f=chunkInvalid(b,c);if(f)a.emit("error",f);else if(util.isNullOrUndefined(c))b.reading=!1,b.ended||onEofChunk(a,b);else if(b.objectMode||c&&c.length>0)if(b.ended&&!e){var g=new Error("stream.push() after EOF");a.emit("error",g)}else if(b.endEmitted&&e){var g=new Error("stream.unshift() after end event");a.emit("error",g)}else!b.decoder||e||d||(c=b.decoder.write(c)),e||(b.reading=!1),b.flowing&&0===b.length&&!b.sync?(a.emit("data",c),a.read(0)):(b.length+=b.objectMode?1:c.length,e?b.buffer.unshift(c):b.buffer.push(c),b.needReadable&&emitReadable(a)),maybeReadMore(a,b);else e||(b.reading=!1);return needMoreData(b)}function needMoreData(a){return!a.ended&&(a.needReadable||a.length<a.highWaterMark||0===a.length)}function roundUpToNextPowerOf2(a){if(a>=MAX_HWM)a=MAX_HWM;else{a--;for(var b=1;32>b;b<<=1)a|=a>>b;a++}return a}function howMuchToRead(a,b){return 0===b.length&&b.ended?0:b.objectMode?0===a?0:1:isNaN(a)||util.isNull(a)?b.flowing&&b.buffer.length?b.buffer[0].length:b.length:0>=a?0:(a>b.highWaterMark&&(b.highWaterMark=roundUpToNextPowerOf2(a)),a>b.length?b.ended?b.length:(b.needReadable=!0,0):a)}function chunkInvalid(a,b){var c=null;return util.isBuffer(b)||util.isString(b)||util.isNullOrUndefined(b)||a.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c}function onEofChunk(a,b){if(b.decoder&&!b.ended){var c=b.decoder.end();c&&c.length&&(b.buffer.push(c),b.length+=b.objectMode?1:c.length)}b.ended=!0,emitReadable(a)}function emitReadable(a){var b=a._readableState;b.needReadable=!1,b.emittedReadable||(debug("emitReadable",b.flowing),b.emittedReadable=!0,b.sync?process.nextTick(function(){emitReadable_(a)}):emitReadable_(a))}function emitReadable_(a){debug("emit readable"),a.emit("readable"),flow(a)}function maybeReadMore(a,b){b.readingMore||(b.readingMore=!0,process.nextTick(function(){maybeReadMore_(a,b)}))}function maybeReadMore_(a,b){for(var c=b.length;!b.reading&&!b.flowing&&!b.ended&&b.length<b.highWaterMark&&(debug("maybeReadMore read 0"),a.read(0),c!==b.length);)c=b.length;b.readingMore=!1}function pipeOnDrain(a){return function(){var b=a._readableState;debug("pipeOnDrain",b.awaitDrain),b.awaitDrain&&b.awaitDrain--,0===b.awaitDrain&&EE.listenerCount(a,"data")&&(b.flowing=!0,flow(a))}}function resume(a,b){b.resumeScheduled||(b.resumeScheduled=!0,process.nextTick(function(){resume_(a,b)}))}function resume_(a,b){b.resumeScheduled=!1,a.emit("resume"),flow(a),b.flowing&&!b.reading&&a.read(0)}function flow(a){var b=a._readableState;if(debug("flow",b.flowing),b.flowing)do var c=a.read();while(null!==c&&b.flowing)}function fromList(a,b){var c,d=b.buffer,e=b.length,f=!!b.decoder,g=!!b.objectMode;if(0===d.length)return null;if(0===e)c=null;else if(g)c=d.shift();else if(!a||a>=e)c=f?d.join(""):Buffer.concat(d,e),d.length=0;else if(a<d[0].length){var h=d[0];c=h.slice(0,a),d[0]=h.slice(a)}else if(a===d[0].length)c=d.shift();else{c=f?"":new Buffer(a);for(var i=0,j=0,k=d.length;k>j&&a>i;j++){var h=d[0],l=Math.min(a-i,h.length);f?c+=h.slice(0,l):h.copy(c,i,0,l),l<h.length?d[0]=h.slice(l):d.shift(),i+=l}}return c}function endReadable(a){var b=a._readableState;if(b.length>0)throw new Error("endReadable called on non-empty stream");b.endEmitted||(b.ended=!0,process.nextTick(function(){b.endEmitted||0!==b.length||(b.endEmitted=!0,a.readable=!1,a.emit("end"))}))}function forEach(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)}function indexOf(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}module.exports=Readable;var isArray=require("isarray"),Buffer=require("buffer").Buffer;Readable.ReadableState=ReadableState;var EE=require("events").EventEmitter;EE.listenerCount||(EE.listenerCount=function(a,b){return a.listeners(b).length});var Stream=require("stream"),util=require("core-util-is");util.inherits=require("inherits");var StringDecoder,debug=require("util");debug=debug&&debug.debuglog?debug.debuglog("stream"):function(){},util.inherits(Readable,Stream),Readable.prototype.push=function(a,b){var c=this._readableState;return util.isString(a)&&!c.objectMode&&(b=b||c.defaultEncoding,b!==c.encoding&&(a=new Buffer(a,b),b="")),readableAddChunk(this,c,a,b,!1)},Readable.prototype.unshift=function(a){var b=this._readableState;return readableAddChunk(this,b,a,"",!0)},Readable.prototype.setEncoding=function(a){return StringDecoder||(StringDecoder=require("string_decoder/").StringDecoder),this._readableState.decoder=new StringDecoder(a),this._readableState.encoding=a,this};var MAX_HWM=8388608;Readable.prototype.read=function(a){debug("read",a);var b=this._readableState,c=a;if((!util.isNumber(a)||a>0)&&(b.emittedReadable=!1),0===a&&b.needReadable&&(b.length>=b.highWaterMark||b.ended))return debug("read: emitReadable",b.length,b.ended),0===b.length&&b.ended?endReadable(this):emitReadable(this),null;if(a=howMuchToRead(a,b),0===a&&b.ended)return 0===b.length&&endReadable(this),null;var d=b.needReadable;debug("need readable",d),(0===b.length||b.length-a<b.highWaterMark)&&(d=!0,debug("length less than watermark",d)),(b.ended||b.reading)&&(d=!1,debug("reading or ended",d)),d&&(debug("do read"),b.reading=!0,b.sync=!0,0===b.length&&(b.needReadable=!0),this._read(b.highWaterMark),b.sync=!1),d&&!b.reading&&(a=howMuchToRead(c,b));var e;return e=a>0?fromList(a,b):null,util.isNull(e)&&(b.needReadable=!0,a=0),b.length-=a,0!==b.length||b.ended||(b.needReadable=!0),c!==a&&b.ended&&0===b.length&&endReadable(this),util.isNull(e)||this.emit("data",e),e},Readable.prototype._read=function(a){this.emit("error",new Error("not implemented"))},Readable.prototype.pipe=function(a,b){function c(a){debug("onunpipe"),a===k&&e()}function d(){debug("onend"),a.end()}function e(){debug("cleanup"),a.removeListener("close",h),a.removeListener("finish",i),a.removeListener("drain",o),a.removeListener("error",g),a.removeListener("unpipe",c),k.removeListener("end",d),k.removeListener("end",e),k.removeListener("data",f),!l.awaitDrain||a._writableState&&!a._writableState.needDrain||o()}function f(b){debug("ondata");var c=a.write(b);!1===c&&(debug("false write response, pause",k._readableState.awaitDrain),k._readableState.awaitDrain++,k.pause())}function g(b){debug("onerror",b),j(),a.removeListener("error",g),0===EE.listenerCount(a,"error")&&a.emit("error",b)}function h(){a.removeListener("finish",i),j()}function i(){debug("onfinish"),a.removeListener("close",h),j()}function j(){debug("unpipe"),k.unpipe(a)}var k=this,l=this._readableState;switch(l.pipesCount){case 0:l.pipes=a;break;case 1:l.pipes=[l.pipes,a];break;default:l.pipes.push(a)}l.pipesCount+=1,debug("pipe count=%d opts=%j",l.pipesCount,b);var m=(!b||b.end!==!1)&&a!==process.stdout&&a!==process.stderr,n=m?d:e;l.endEmitted?process.nextTick(n):k.once("end",n),a.on("unpipe",c);var o=pipeOnDrain(k);return a.on("drain",o),k.on("data",f),a._events&&a._events.error?isArray(a._events.error)?a._events.error.unshift(g):a._events.error=[g,a._events.error]:a.on("error",g),a.once("close",h),a.once("finish",i),a.emit("pipe",k),l.flowing||(debug("pipe resume"),k.resume()),a},Readable.prototype.unpipe=function(a){var b=this._readableState;if(0===b.pipesCount)return this;if(1===b.pipesCount)return a&&a!==b.pipes?this:(a||(a=b.pipes),b.pipes=null,b.pipesCount=0,b.flowing=!1,a&&a.emit("unpipe",this),this);if(!a){var c=b.pipes,d=b.pipesCount;b.pipes=null,b.pipesCount=0,b.flowing=!1;for(var e=0;d>e;e++)c[e].emit("unpipe",this);return this}var e=indexOf(b.pipes,a);return-1===e?this:(b.pipes.splice(e,1),b.pipesCount-=1,1===b.pipesCount&&(b.pipes=b.pipes[0]),a.emit("unpipe",this),this)},Readable.prototype.on=function(a,b){var c=Stream.prototype.on.call(this,a,b);if("data"===a&&!1!==this._readableState.flowing&&this.resume(),"readable"===a&&this.readable){var d=this._readableState;if(!d.readableListening)if(d.readableListening=!0,d.emittedReadable=!1,d.needReadable=!0,d.reading)d.length&&emitReadable(this,d);else{var e=this;process.nextTick(function(){debug("readable nexttick read 0"),e.read(0)})}}return c},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var a=this._readableState;return a.flowing||(debug("resume"),a.flowing=!0,a.reading||(debug("resume read 0"),this.read(0)),resume(this,a)),this},Readable.prototype.pause=function(){return debug("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(debug("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(a){var b=this._readableState,c=!1,d=this;a.on("end",function(){if(debug("wrapped end"),b.decoder&&!b.ended){var a=b.decoder.end();a&&a.length&&d.push(a)}d.push(null)}),a.on("data",function(e){if(debug("wrapped data"),b.decoder&&(e=b.decoder.write(e)),e&&(b.objectMode||e.length)){var f=d.push(e);f||(c=!0,a.pause())}});for(var e in a)util.isFunction(a[e])&&util.isUndefined(this[e])&&(this[e]=function(b){return function(){return a[b].apply(a,arguments)}}(e));var f=["error","close","destroy","pause","resume"];return forEach(f,function(b){a.on(b,d.emit.bind(d,b))}),d._read=function(b){debug("wrapped _read",b),c&&(c=!1,a.resume())},d},Readable._fromList=fromList;