function eventReducer(a,b){return"onerror"===b[0]||"onend"===b[0]||("ontext"===b[0]&&a.length&&"text"===a[a.length-1].event?a[a.length-1].data[0]+=b[1]:a.push({event:b[0].substr(2),data:b.slice(1)})),a}function getCallback(a,b){var c=!1;return function(d,e){assert.ifError(d);try{assert.deepEqual(a,e,"didn't get expected output")}catch(f){throw f.expected=JSON.stringify(a,null,2),f.actual=JSON.stringify(e,null,2),f}c?b():c=!0}}var htmlparser2=require(".."),fs=require("fs"),path=require("path"),assert=require("assert"),Parser=htmlparser2.Parser,CollectingHandler=htmlparser2.CollectingHandler;exports.writeToParser=function(a,b,c){for(var d=new Parser(a,b),e=0;e<c.length;e++)d.write(c.charAt(e));d.end(),d.parseComplete(c)},exports.getEventCollector=function(a){function b(){a(null,c.events.reduce(eventReducer,[]))}var c=new CollectingHandler({onerror:a,onend:b});return c},exports.mochaTest=function(a,b,c){function d(){var c=path.join(b,a);fs.readdirSync(c).filter(RegExp.prototype.test,/^[^\._]/).map(function(a){return path.join(c,a)}).map(require).forEach(e)}function e(a){it(a.name,function(b){c(a,getCallback(a.expected,b))})}describe(a,d)};