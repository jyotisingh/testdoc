function compile(a,b){var c=compileUnsafe(a,b);return wrap(c)}function wrap(a){return function(b){return isTag(b)&&a(b)}}function compileUnsafe(a,b){var c=parse(a,b);return compileToken(c,b)}function compileToken(a,b){if(a.forEach(sortRules),b&&b.context){var c=b.context;a.forEach(function(a){isTraversal(a[0])||a.unshift({type:"descendant"})});var d=Array.isArray(c)?function(a){return c.indexOf(a)>=0}:function(a){return c===a};if(b.rootFunc){var e=b.rootFunc;b.rootFunc=function(a){return d(a)&&e(a)}}else b.rootFunc=d}return a.map(compileRules,b).reduce(reduceRules,falseFunc)}function isTraversal(a){return procedure[a.type]<0}function compileRules(a){if(0===a.length)return falseFunc;var b=this;return a.reduce(function(a,c){return a===falseFunc?a:Rules[c.type](a,c,b)},b&&b.rootFunc||trueFunc)}function reduceRules(a,b){return b===falseFunc||a===trueFunc?a:a===falseFunc||b===trueFunc?b:function(c){return a(c)||b(c)}}function containsTraversal(a){return a.some(isTraversal)}function stripQuotes(a){var b=a.charAt(0);return b!==a.slice(-1)||"'"!==b&&'"'!==b||(a=a.slice(1,-1)),a}module.exports=compile,module.exports.compileUnsafe=compileUnsafe;var parse=require("css-what"),DomUtils=require("domutils"),isTag=DomUtils.isTag,Rules=require("./general.js"),sortRules=require("./sort.js"),BaseFuncs=require("boolbase"),trueFunc=BaseFuncs.trueFunc,falseFunc=BaseFuncs.falseFunc,procedure=require("./procedure.json"),Pseudos=require("./pseudos.js"),filters=Pseudos.filters,existsOne=DomUtils.existsOne,isTag=DomUtils.isTag,getChildren=DomUtils.getChildren;filters.not=function(a,b,c){var d,e={xmlMode:!(!c||!c.xmlMode),strict:!(!c||!c.strict)};if(b=stripQuotes(b),e.strict){var f=parse(b);if(f.length>1||f.some(containsTraversal))throw new SyntaxError("complex selectors in :not aren't allowed in strict mode");d=compileToken(f,e)}else d=compileUnsafe(b,e);return d===falseFunc?a:d===trueFunc?falseFunc:function(b){return!d(b)&&a(b)}},filters.has=function(a,b,c){var d={xmlMode:!(!c||!c.xmlMode),strict:!(!c||!c.strict)},e=compileUnsafe(b,d);return e===falseFunc?falseFunc:e===trueFunc?function(b){return getChildren(b).some(isTag)&&a(b)}:(e=wrap(e),function(b){return a(b)&&existsOne(e,getChildren(b))})},filters.matches=function(a,b,c){var d={xmlMode:!(!c||!c.xmlMode),strict:!(!c||!c.strict),rootFunc:a};return b=stripQuotes(b),compileUnsafe(b,d)};