var DomUtils=require("domutils"),hasAttrib=DomUtils.hasAttrib,getAttributeValue=DomUtils.getAttributeValue,falseFunc=require("boolbase").falseFunc,reChars=/[-[\]{}()*+?.,\\^$|#\s]/g,attributeRules={__proto__:null,equals:function(a,b){var c=b.name,d=b.value;return b.ignoreCase?(d=d.toLowerCase(),function(b){var e=getAttributeValue(b,c);return null!=e&&e.toLowerCase()===d&&a(b)}):function(b){return getAttributeValue(b,c)===d&&a(b)}},hyphen:function(a,b){var c=b.name,d=b.value,e=d.length;return b.ignoreCase?(d=d.toLowerCase(),function(b){var f=getAttributeValue(b,c);return null!=f&&(f.length===e||"-"===f.charAt(e))&&f.substr(0,e).toLowerCase()===d&&a(b)}):function(b){var f=getAttributeValue(b,c);return null!=f&&f.substr(0,e)===d&&(f.length===e||"-"===f.charAt(e))&&a(b)}},element:function(a,b){var c=b.name,d=b.value;if(/\s/.test(d))return falseFunc;d=d.replace(reChars,"\\$&");var e="(?:^|\\s)"+d+"(?:$|\\s)",f=b.ignoreCase?"i":"",g=new RegExp(e,f);return function(b){var d=getAttributeValue(b,c);return null!=d&&g.test(d)&&a(b)}},exists:function(a,b){var c=b.name;return function(b){return hasAttrib(b,c)&&a(b)}},start:function(a,b){var c=b.name,d=b.value,e=d.length;return 0===e?falseFunc:b.ignoreCase?(d=d.toLowerCase(),function(b){var f=getAttributeValue(b,c);return null!=f&&f.substr(0,e).toLowerCase()===d&&a(b)}):function(b){var f=getAttributeValue(b,c);return null!=f&&f.substr(0,e)===d&&a(b)}},end:function(a,b){var c=b.name,d=b.value,e=-d.length;return 0===e?falseFunc:b.ignoreCase?(d=d.toLowerCase(),function(b){var f=getAttributeValue(b,c);return null!=f&&f.substr(e).toLowerCase()===d&&a(b)}):function(b){var f=getAttributeValue(b,c);return null!=f&&f.substr(e)===d&&a(b)}},any:function(a,b){var c=b.name,d=b.value;if(""===d)return falseFunc;if(b.ignoreCase){var e=new RegExp(d.replace(reChars,"\\$&"),"i");return function(b){var d=getAttributeValue(b,c);return null!=d&&e.test(d)&&a(b)}}return function(b){var e=getAttributeValue(b,c);return null!=e&&e.indexOf(d)>=0&&a(b)}},not:function(a,b){var c=b.name,d=b.value;return""===d?function(b){return!!getAttributeValue(b,c)&&a(b)}:b.ignoreCase?(d=d.toLowerCase(),function(b){var e=getAttributeValue(b,c);return null!=e&&e.toLowerCase()!==d&&a(b)}):function(b){return getAttributeValue(b,c)!==d&&a(b)}}};module.exports={compile:function(a,b,c){if(c&&c.strict&&(b.ignoreCase||"not"===b.action))throw SyntaxError("Unsupported attribute selector");return attributeRules[b.action](a,b)},rules:attributeRules};