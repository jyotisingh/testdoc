var expect=require("expect.js"),fixtures=require("../fixtures"),cheerio=require("../..");describe("cheerio",function(){describe(".html",function(){it("() : should return innerHTML; $.html(obj) should return outerHTML",function(){var a=cheerio("div","<div><span>foo</span><span>bar</span></div>"),b=a.children()[1];expect(cheerio(b).html()).to.equal("bar"),expect(cheerio.html(b)).to.equal("<span>bar</span>")}),it("(<obj>) : should accept an object, an array, or a cheerio object",function(){var a=cheerio("<span>foo</span>");expect(cheerio.html(a[0])).to.equal("<span>foo</span>"),expect(cheerio.html(a)).to.equal("<span>foo</span>")}),it("(<value>) : should be able to set to an empty string",function(){var a=cheerio("<span>foo</span>").html("");expect(cheerio.html(a)).to.equal("<span></span>")}),it("() : of empty cheerio object should return null",function(){expect(cheerio().html()).to.be(null)}),it("(selector) : should return the outerHTML of the selected element",function(){var a=cheerio.load(fixtures.fruits);expect(a.html(".pear")).to.equal('<li class="pear">Pear</li>')})}),describe(".load",function(){it("(html) : should retain original root after creating a new node",function(){var a=cheerio.load('<body><ul id="fruits"></ul></body>');expect(a("body")).to.have.length(1),a("<script>"),expect(a("body")).to.have.length(1)}),it("(html) : should handle lowercase tag options",function(){var a=cheerio.load('<BODY><ul id="fruits"></ul></BODY>',{lowerCaseTags:!0});expect(a.html()).to.be('<body><ul id="fruits"></ul></body>')}),it("(html) : should handle the `normalizeWhitepace` option",function(){var a=cheerio.load("<body><b>foo</b>  <b>bar</b></body>",{normalizeWhitespace:!0});expect(a.html()).to.be("<body><b>foo</b> <b>bar</b></body>")}),it("(buffer) : should accept a buffer",function(){var a=cheerio.load(new Buffer("<div>foo</div>"));expect(a.html()).to.be("<div>foo</div>")})}),describe(".clone",function(){it("() : should return a copy",function(){var a=cheerio("<div><span>foo</span><span>bar</span><span>baz</span></div>").children(),b=a.clone();expect(b.length).to.equal(3),expect(b.parent()).to.have.length(0),expect(b.text()).to.equal(a.text()),a.text("rofl"),expect(b.text()).to.not.equal(a.text())}),it("() : should preserve parsing options",function(){var a=cheerio.load("<div>Ï€</div>",{decodeEntities:!1}),b=a("div");expect(b.text()).to.equal(b.clone().text())})}),describe(".parseHTML",function(){it("() : returns null",function(){expect(cheerio.parseHTML()).to.equal(null)}),it("(null) : returns null",function(){expect(cheerio.parseHTML(null)).to.equal(null)}),it('("") : returns null',function(){expect(cheerio.parseHTML("")).to.equal(null)}),it("(largeHtmlString) : parses large HTML strings",function(){var a=new Array(10).join("<div></div>"),b=cheerio.parseHTML(a);expect(b.length).to.be.greaterThan(4),expect(b).to.be.an("array")}),it('("<script>") : ignores scripts by default',function(){var a="<script>undefined()</script>";expect(cheerio.parseHTML(a)).to.have.length(0)}),it('("<script>", true) : preserves scripts when requested',function(){var a="<script>undefined()</script>";expect(cheerio.parseHTML(a,!0)[0].tagName).to.match(/script/i)}),it('("scriptAndNonScript) : preserves non-script nodes',function(){var a="<script>undefined()</script><div></div>";expect(cheerio.parseHTML(a)[0].tagName).to.match(/div/i)}),it("(scriptAndNonScript, true) : Preserves script position",function(){var a="<script>undefined()</script><div></div>";expect(cheerio.parseHTML(a,!0)[0].tagName).to.match(/script/i)}),it("(text) : returns a text node",function(){expect(cheerio.parseHTML("text")[0].type).to.be("text")}),it("(\\ttext) : preserves leading whitespace",function(){expect(cheerio.parseHTML("	<div></div>")[0].data).to.equal("	")}),it("( text) : Leading spaces are treated as text nodes",function(){expect(cheerio.parseHTML(" <div/> ")[0].type).to.be("text")}),it("(html) : should preserve content",function(){var a="<div>test div</div>";expect(cheerio(cheerio.parseHTML(a)[0]).html()).to.equal("test div")}),it("(malformedHtml) : should not break",function(){expect(cheerio.parseHTML("<span><span>")).to.have.length(1)}),it("(garbageInput) : should not cause an error",function(){expect(cheerio.parseHTML("<#if><tr><p>This is a test.</p></tr><#/if>")||!0).to.be.ok()}),it("(text) : should return an array that is not effected by DOM manipulation methods",function(){var a=cheerio.load("<div>"),b=a.parseHTML("<b></b><i></i>");a("div").append(b),expect(b).to.have.length(2)})}),describe(".contains",function(){var a;beforeEach(function(){a=cheerio.load(fixtures.food)}),it("(container, contained) : should correctly detect the provided element",function(){var b=a("#food"),c=a("#fruits"),d=a(".apple");expect(a.contains(b[0],c[0])).to.equal(!0),expect(a.contains(b[0],d[0])).to.equal(!0)}),it("(container, other) : should not detect elements that are not contained",function(){var b=a("#fruits"),c=a("#vegetables"),d=a(".apple");expect(a.contains(c[0],d[0])).to.equal(!1),expect(a.contains(b[0],c[0])).to.equal(!1),expect(a.contains(c[0],b[0])).to.equal(!1),expect(a.contains(b[0],b[0])).to.equal(!1),expect(a.contains(c[0],c[0])).to.equal(!1)})}),describe(".root",function(){it("() : should return a cheerio-wrapped root object",function(){var a=cheerio.load("<div><span>foo</span><span>bar</span></div>");a.root().append('<div id="test"></div>'),expect(a.html()).to.equal('<div><span>foo</span><span>bar</span></div><div id="test"></div>')})})});